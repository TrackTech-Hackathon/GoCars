[gd_resource type="VisualShader" load_steps=7 format=3 uid="uid://cuvy1qnqtbk3v"]

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_fr5ib"]
input_name = "texture"

[sub_resource type="VisualShaderNodeTexture" id="VisualShaderNodeTexture_yvryk"]
source = 5

[sub_resource type="VisualShaderNodeTexture2DParameter" id="VisualShaderNodeTexture2DParameter_dlgfq"]
parameter_name = "Red_Palette"

[sub_resource type="VisualShaderNodeTexture2DParameter" id="VisualShaderNodeTexture2DParameter_5cppi"]
parameter_name = "White_Palette2"

[sub_resource type="VisualShaderNodeIntParameter" id="VisualShaderNodeIntParameter_baosx"]
parameter_name = "Colors_Count"

[sub_resource type="VisualShaderNodeExpression" id="VisualShaderNodeExpression_l78fu"]
size = Vector2(540, 500.00003)
expression = "vec2 new_uv = vec2(0, 0);

for (int i = 0; i < colors_count; i++) {
	float u = (float(i) + 0.5) / float(colors_count);
	float v = 0.5;
	vec2 uv = vec2(u, v);
	vec4 original_palette_color = texture(original_pallete, uv);
	float dist = distance(color, original_palette_color);
	
	if (dist == 0.0) {
		new_uv = uv;
		break;
	}
}

new_color = texture(new_pallete, new_uv);"

[resource]
code = "shader_type canvas_item;
render_mode blend_mix;

uniform sampler2D Red_Palette;
uniform sampler2D White_Palette2;
uniform int Colors_Count;



void fragment() {
	vec4 n_out4p0;
// Texture2D:4
	n_out4p0 = texture(TEXTURE, UV);


// IntParameter:7
	int n_out7p0 = Colors_Count;


	vec4 n_out8p0;
// Expression:8
	n_out8p0 = vec4(0.0, 0.0, 0.0, 0.0);
	{
		vec2 new_uv = vec2(0, 0);
		
		for (int i = 0; i < n_out7p0; i++) {
			float u = (float(i) + 0.5) / float(n_out7p0);
			float v = 0.5;
			vec2 uv = vec2(u, v);
			vec4 original_palette_color = texture(original_pallete, uv);
			float dist = distance(n_out4p0, original_palette_color);
			
			if (dist == 0.0) {
				new_uv = uv;
				break;
			}
		}
		
		n_out8p0 = texture(new_pallete, new_uv);
	}


// Output:0
	COLOR.rgb = vec3(n_out8p0.xyz);


}
"
mode = 1
flags/light_only = false
nodes/fragment/0/position = Vector2(900, 20)
nodes/fragment/2/node = SubResource("VisualShaderNodeInput_fr5ib")
nodes/fragment/2/position = Vector2(-380, -220)
nodes/fragment/4/node = SubResource("VisualShaderNodeTexture_yvryk")
nodes/fragment/4/position = Vector2(-120, -220)
nodes/fragment/5/node = SubResource("VisualShaderNodeTexture2DParameter_dlgfq")
nodes/fragment/5/position = Vector2(-380, 20)
nodes/fragment/6/node = SubResource("VisualShaderNodeTexture2DParameter_5cppi")
nodes/fragment/6/position = Vector2(-380, 320)
nodes/fragment/7/node = SubResource("VisualShaderNodeIntParameter_baosx")
nodes/fragment/7/position = Vector2(-200, 620)
nodes/fragment/8/node = SubResource("VisualShaderNodeExpression_l78fu")
nodes/fragment/8/position = Vector2(240, -20)
nodes/fragment/8/size = Vector2(540, 500.00003)
nodes/fragment/8/input_ports = "0,5,color;1,8,original_palette;2,8,new_palette;3,1,colors_count;"
nodes/fragment/8/output_ports = "0,5,new_color;"
nodes/fragment/8/expression = "vec2 new_uv = vec2(0, 0);

for (int i = 0; i < colors_count; i++) {
	float u = (float(i) + 0.5) / float(colors_count);
	float v = 0.5;
	vec2 uv = vec2(u, v);
	vec4 original_palette_color = texture(original_pallete, uv);
	float dist = distance(color, original_palette_color);
	
	if (dist == 0.0) {
		new_uv = uv;
		break;
	}
}

new_color = texture(new_pallete, new_uv);"
nodes/fragment/connections = PackedInt32Array(2, 0, 4, 2, 4, 0, 8, 0, 5, 0, 8, 1, 6, 0, 8, 2, 7, 0, 8, 3, 8, 0, 0, 0)
