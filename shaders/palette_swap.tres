[gd_resource type="VisualShader" load_steps=7 format=3 uid="uid://cw7qkp1qc7qlg"]

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_2quu1"]
input_name = "texture"

[sub_resource type="VisualShaderNodeTexture2DParameter" id="VisualShaderNodeTexture2DParameter_wxuq5"]
parameter_name = "new_palette"

[sub_resource type="VisualShaderNodeTexture2DParameter" id="VisualShaderNodeTexture2DParameter_sktee"]
parameter_name = "original_palette"

[sub_resource type="VisualShaderNodeTexture" id="VisualShaderNodeTexture_q5ui8"]
source = 5

[sub_resource type="VisualShaderNodeIntParameter" id="VisualShaderNodeIntParameter_v0s2l"]
parameter_name = "colors_count"

[sub_resource type="VisualShaderNodeExpression" id="VisualShaderNodeExpression_5lhqi"]
size = Vector2(540, 500.00003)
expression = "vec2 new_uv = vec2(0, 0);

for (int i = 0; i < colors_count; i++) {
	float u = (float(i) + 0.5) / float(colors_count);
	float v = 0.5;
	vec2 uv = vec2(u, v);
	vec4 original_palette_color = texture(original_palette, uv);
	float dist = distance(color, original_palette_color);
	
	if (dist == 0.0) {
		new_uv = uv;
		break;
	}
}
new_color = texture(new_palette, new_uv);"

[resource]
code = "shader_type canvas_item;
render_mode blend_mix;

uniform sampler2D original_palette;
uniform sampler2D new_palette;
uniform int colors_count;



void fragment() {
	vec4 n_out5p0;
// Texture2D:5
	n_out5p0 = texture(TEXTURE, UV);


// IntParameter:6
	int n_out6p0 = colors_count;


	vec4 n_out7p0;
// Expression:7
	n_out7p0 = vec4(0.0, 0.0, 0.0, 0.0);
	{
		vec2 new_uv = vec2(0, 0);
		
		for (int i = 0; i < n_out6p0; i++) {
			float u = (float(i) + 0.5) / float(n_out6p0);
			float v = 0.5;
			vec2 uv = vec2(u, v);
			vec4 original_palette_color = texture(original_palette, uv);
			float dist = distance(n_out5p0, original_palette_color);
			
			if (dist == 0.0) {
				new_uv = uv;
				break;
			}
		}
		n_out7p0 = texture(new_palette, new_uv);
	}


// Output:0
	COLOR.rgb = vec3(n_out7p0.xyz);


}
"
mode = 1
flags/light_only = false
nodes/fragment/0/position = Vector2(740, 520)
nodes/fragment/2/node = SubResource("VisualShaderNodeInput_2quu1")
nodes/fragment/2/position = Vector2(-739.99524, 354.62787)
nodes/fragment/3/node = SubResource("VisualShaderNodeTexture2DParameter_wxuq5")
nodes/fragment/3/position = Vector2(-739.99524, 894.62787)
nodes/fragment/4/node = SubResource("VisualShaderNodeTexture2DParameter_sktee")
nodes/fragment/4/position = Vector2(-739.99524, 594.62787)
nodes/fragment/5/node = SubResource("VisualShaderNodeTexture_q5ui8")
nodes/fragment/5/position = Vector2(-479.99524, 354.62787)
nodes/fragment/6/node = SubResource("VisualShaderNodeIntParameter_v0s2l")
nodes/fragment/6/position = Vector2(-260, 700)
nodes/fragment/7/node = SubResource("VisualShaderNodeExpression_5lhqi")
nodes/fragment/7/position = Vector2(60, 380)
nodes/fragment/7/size = Vector2(540, 500.00003)
nodes/fragment/7/input_ports = "0,5,color;1,8,original_palette;2,8,new_palette;3,1,colors_count;"
nodes/fragment/7/output_ports = "0,5,new_color;"
nodes/fragment/7/expression = "vec2 new_uv = vec2(0, 0);

for (int i = 0; i < colors_count; i++) {
	float u = (float(i) + 0.5) / float(colors_count);
	float v = 0.5;
	vec2 uv = vec2(u, v);
	vec4 original_palette_color = texture(original_palette, uv);
	float dist = distance(color, original_palette_color);
	
	if (dist == 0.0) {
		new_uv = uv;
		break;
	}
}
new_color = texture(new_palette, new_uv);"
nodes/fragment/connections = PackedInt32Array(2, 0, 5, 2, 5, 0, 7, 0, 3, 0, 7, 2, 4, 0, 7, 1, 7, 0, 0, 0, 6, 0, 7, 3)
